<html>
<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

    <style>
        table, tr, th, td {
            font-size: 24px;
            border: 1px black solid;
            border-collapse: collapse;
        }

        th, td {
            width: 120px;
        }

        th {
            text-align: center;
        }

        td {
            text-align: center;
        }

        button {
            font-size: 24px;
            width: 100%;
        }

        input {
            font-size: 24px;
            text-align: center;
            border: none;
            width: 120px;
        }
    </style>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th><input type="checkbox" id="chain" /></th>
                <th>#C</th>
                <th>From</th>
                <th>To</th>
                <th>#XP</th>
                <th>#B</th>
                <th>#E</th>
                <th>#P</th>
                <th>Efficiency</th>
            </tr>
        </thead>
        <tbody>
            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="level_6">
                <td><button class="fill">6</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" /></td>
                <td><input class="from" type="number" min="0" max="60" value="0" /></td>
                <td><input class="to" type="number" min="0" max="60" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="rank_5">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" /></td>
                <td style="background-color: black;" colspan="5"></td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="level_5">
                <td><button class="fill">5</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="50" value="0" /></td>
                <td><input class="to" type="number" min="0" max="50" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="boost_5">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="50" value="0" /></td>
                <td><input class="to" type="number" min="0" max="50" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="rank_4">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td style="background-color: black;" colspan="5"></td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="level_4">
                <td><button class="fill">4</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="40" value="0" /></td>
                <td><input class="to" type="number" min="0" max="40" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="boost_4">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="40" value="0" /></td>
                <td><input class="to" type="number" min="0" max="40" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="rank_3">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td style="background-color: black;" colspan="5"></td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="level_3">
                <td><button class="fill">3</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="30" value="0" /></td>
                <td><input class="to" type="number" min="0" max="30" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="boost_3">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="30" value="0" /></td>
                <td><input class="to" type="number" min="0" max="30" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="rank_2">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td style="background-color: black;" colspan="5"></td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="level_2">
                <td><button class="fill">2</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="20" value="0" /></td>
                <td><input class="to" type="number" min="0" max="20" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="boost_2">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="20" value="0" /></td>
                <td><input class="to" type="number" min="0" max="20" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>

            <tr id="rank_1">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td style="background-color: black;" colspan="5"></td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="level_1">
                <td><button class="fill">1</button></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="10" value="0" /></td>
                <td><input class="to" type="number" min="0" max="10" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td style="background-color: black;"></td>
            </tr>
            <tr id="boost_1">
                <td style="background-color: black;"></td>
                <td><input class="champions" type="number" min="0" max="2048" value="0" step="3" /></td>
                <td><input class="from" type="number" min="0" max="10" value="0" /></td>
                <td><input class="to" type="number" min="0" max="10" value="0" /></td>
                <td class="experience">0</td>
                <td class="battles">00#00#00</td>
                <td class="energy">0</td>
                <td class="points">0</td>
                <td class="efficiency">0</td>
            </tr>

            <tr style="background-color: black;"><td colspan="9"></td></tr>
        </tbody>
        <tfoot>
            <tr style="font-weight: bold;">
                <td colspan="6" style="background-color: black;"></td>
                <td id="total-energy">0</td>
                <td id="total-points">0</td>
                <td id="total-efficiency">0</td>
            </tr>
            <tr>
                <td colspan="9"><button id="reset">Reset</button></td>
            </tr>
        </tfoot>
    </table>

    <script>
        (function($) {
            const Raid = {
                championExperience: [
                    [
                        0,
                        897,
                        1118,
                        1393,
                        1736,
                        2163,
                        2695,
                        3359,
                        4185,
                        5215,
                    ],
                    [
                        0,
                        1110,
                        1258,
                        1426,
                        1616,
                        1831,
                        2075,
                        2351,
                        2664,
                        3019,
                        3421,
                        3876,
                        4392,
                        4977,
                        5640,
                        6390,
                        7241,
                        8205,
                        9298,
                        10536
                    ],
                    [
                        0,
                        1279,
                        1411,
                        1556,
                        1717,
                        1893,
                        2088,
                        2303,
                        2541,
                        2802,
                        3091,
                        3409,
                        3760,
                        4147,
                        4574,
                        5045,
                        5565,
                        6138,
                        6769,
                        7466,
                        8235,
                        9083,
                        10018,
                        11050,
                        12188,
                        13442,
                        14827,
                        16353,
                        18037,
                        19894
                    ],
                    [
                        0,
                        1460,
                        1591,
                        1734,
                        1890,
                        2060,
                        2245,
                        2447,
                        2666,
                        2906,
                        3167,
                        3451,
                        3761,
                        4099,
                        4467,
                        4868,
                        5305,
                        5782,
                        6301,
                        6867,
                        7483,
                        8155,
                        8888,
                        9686,
                        10556,
                        11504,
                        12537,
                        13663,
                        14890,
                        16227,
                        17684,
                        19272,
                        21003,
                        22889,
                        24945,
                        27185,
                        29627,
                        32287,
                        35187,
                        38347
                    ],
                    [
                        0,
                        1625,
                        1760,
                        1907,
                        2066,
                        2238,
                        2424,
                        2626,
                        2845,
                        3082,
                        3338,
                        3616,
                        3918,
                        4244,
                        4597,
                        4980,
                        5395,
                        5844,
                        6331,
                        6858,
                        7430,
                        8048,
                        8719,
                        9445,
                        10231,
                        11084,
                        12007,
                        13007,
                        14090,
                        15264,
                        16535,
                        17912,
                        19404,
                        21020,
                        22770,
                        24667,
                        26721,
                        28947,
                        31358,
                        33970,
                        36799,
                        39864,
                        43184,
                        46780,
                        50677,
                        54897,
                        59470,
                        64423,
                        69788,
                        75601
                    ],
                    [
                        0,
                        1813,
                        1956,
                        2110,
                        2277,
                        2457,
                        2651,
                        2860,
                        3086,
                        3329,
                        3592,
                        3876,
                        4182,
                        4512,
                        4869,
                        5253,
                        5668,
                        6115,
                        6598,
                        7119,
                        7681,
                        8288,
                        8942,
                        9648,
                        10410,
                        11232,
                        12119,
                        13076,
                        14109,
                        15223,
                        16425,
                        17722,
                        19121,
                        20631,
                        22260,
                        24018,
                        25914,
                        27961,
                        30168,
                        32551,
                        35121,
                        37894,
                        40886,
                        44115,
                        47598,
                        51357,
                        55412,
                        59787,
                        64508,
                        69602,
                        75098,
                        81028,
                        87426,
                        94329,
                        101778,
                        109815,
                        118486,
                        127842,
                        137937,
                        148828
                    ]
                ],
                battleExperience: [
                    3564,
                    5900,
                    8652
                ],
                battleEnergy: [
                    4,
                    6,
                    8,
                    16
                ],
                levelPoints: [
                    1,
                    1,
                    2,
                    3,
                    6,
                    8
                ],
                rankPoints: [
                    5,
                    15,
                    50,
                    100,
                    300
                ],
                boostLevels: [
                	4,
                	5,
                	11,
                	16,
                	24
                ]
            };

            Raid.setupUI = function() {
                $('input[type="number"]').on('change', function() {
                    if ($('input[type="checkbox"]').is(':checked')) {
                        let id = $(this).parents('tr').attr('id');

                        Raid.chain(id);
                    }

                    Raid.calculate();
                    Raid.calculateEfficiency();
                });

                $('button.fill').on('click', function() {
                    let id = $(this).parents('tr').attr('id');
                	let rank = parseInt(id.split('_')[1]);

                    $('#level_' + rank + ' input.from').val(0);
                    $('#level_' + rank + ' input.to').val(rank * 10);

                    $('#boost_' + rank + ' input.from').val(0);
                    $('#boost_' + rank + ' input.to').val(Raid.boostLevels[rank - 1]);

                    Raid.calculate();
                    Raid.calculateEfficiency();
                });

                $('button#reset').on('click', function () {
                    Raid.reset();
                });
            };

            Raid.chain = function (id) {
                if (id.split('_')[0] === 'rank') {
                    let rank = parseInt(id.split('_')[1]);
                    
					let championCount = 0;
                    for (let i = rank; i > 0; i--) {
						if (i === rank) {
							championCount = parseInt($('#rank_' + i + ' input.champions').val());
						} else {
							championCount = parseInt($('#rank_' + (i + 1) + ' input.champions').val()) * (i + 2);
						}

						$('#rank_' + i + ' input.champions').val(championCount);

						$('#level_' + i + ' input.champions').val(championCount);
						$('#level_' + i + ' input.from').val(0);
						$('#level_' + i + ' input.to').val(i * 10);

						$('#boost_' + i + ' input.champions').val(championCount * i);
						$('#boost_' + i + ' input.from').val(0);
						$('#boost_' + i + ' input.to').val(this.boostLevels[i - 1]);
                    }
                }
            }

            Raid.reset = function() {
                $('tbody input').val(0);
                $('tbody .experience').text(0);
                $('tbody .battles').text('00#00#00');
                $('tbody .energy').text(0);
                $('tbody .points').text(0);
                $('tbody .efficiency').text(0);

                $('tfoot #total-energy').text(0);
                $('tfoot #total-points').text(0);
                $('tfoot #total-efficiency').text(0);
            }

            Raid.calculate = function() {
                $('tbody tr').each(function() {
                    let id = $(this).attr('id');
                    if (id) {
	                    let valid = true;
	                    $(this).find('input').each(function() {
	                        let min = parseInt($(this).attr('min'));
	                        let max = parseInt($(this).attr('max'));
	                        let value = parseInt($(this).val());

	                        if (!(value >= min && value <= max)) {
	                            valid = false;
	                        }
	                    });


	                    if (valid) {
	                        let action = id.split('_')[0];
	                        let rank = parseInt(id.split('_')[1]);
	                        let championCount = parseInt($('#' + id + ' .champions').val());

	                        let $points = $('#' + action + '_' + rank + ' .points');
	                        switch (action) {
	                            case 'level':
	                            case 'boost':
	                                let from = parseInt($('#' + id + ' .from').val());
	                                let to =  parseInt($('#' + id + ' .to').val());

	                                if (from <= to) {
	                                    let $experience = $('#' + action + '_' + rank + ' .experience');
	                                    let $battles = $('#' + action + '_' + rank + ' .battles');
	                                    let $energy = $('#' + action + '_' + rank + ' .energy');

	                                    let experience = Raid.calculateExperience(rank, to) -  Raid.calculateExperience(rank, from);
	                                    let battles = Raid.calculateBattles(experience);
	                                    let energy = Raid.calculateEnergy(experience);
	                                    let points = Raid.calculateLevelPoints(rank, from, to);

	                                    $experience.text(experience * Math.ceil(championCount / 3));
	                                    $battles.text(battles);
	                                    $energy.text(energy * Math.ceil(championCount / 3));
	                                    $points.text(points * championCount);
	                                }

	                                break;
	                            case 'rank':
	                                let points = Raid.calculateRankPoints(rank);
	                                $points.text(points * championCount);

	                                break;
	                        }
	                    }
                    }
                });

                let totalEnergy = 0;
                $('tbody td.energy').each(function() {
                    totalEnergy += parseInt($(this).text());
                });
                $('#total-energy').text(new Intl.NumberFormat('nl-BE').format(totalEnergy));

                let totalPoints = 0;
                $('tbody td.points').each(function() {
                    totalPoints += parseInt($(this).text());
                });
                $('#total-points').text(new Intl.NumberFormat('nl-BE').format(totalPoints));

                let totalEfficiency = 0;
                if (totalEnergy > 0) {
                    totalEfficiency = totalPoints / totalEnergy;
                }
                $('#total-efficiency').text(new Intl.NumberFormat('nl-BE').format(totalEfficiency));
            }

            Raid.calculateExperience = function(rank, level) {
                let experience = 0;

                for (let i = 0; i < level; i++) {
                    experience += this.championExperience[rank - 1][i];
                }

                return experience;
            };

            Raid.calculateBattles = function(experience) {
                let battles = '00#00#00';

                if (experience > 0) {
                    let battleCount = Math.floor(experience / this.battleExperience[2]);

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[2] >= experience) {
                        battles = '00#00#' + String(battleCount + 1).padStart(2, '0');
                    }

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[1] >= experience) {
                        battles = '00#01#' + String(battleCount).padStart(2, '0');
                    }

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[0] >= experience) {
                        battles = '01#00#' + String(battleCount).padStart(2, '0');
                    }
                }

                return battles;
            }

            Raid.calculateEnergy = function(experience) {
                let energy = 0;

                if (experience > 0) {
                    let battleCount = Math.floor(experience / this.battleExperience[2]);

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[2] >= experience) {
                        energy = (battleCount * this.battleEnergy[2]) + this.battleEnergy[2];
                    }

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[1] >= experience) {
                        energy = (battleCount * this.battleEnergy[2]) + this.battleEnergy[1];
                    }

                    if ((battleCount * this.battleExperience[2]) + this.battleExperience[0] >= experience) {
                        energy = (battleCount * this.battleEnergy[2]) + this.battleEnergy[0];
                    }
                }

                return energy;
            };

            Raid.calculateLevelPoints = function (rank, from, to) {
                return this.levelPoints[rank - 1] * (Math.max(1, to) - Math.max(1, from));
            };

            Raid.calculateRankPoints = function(rank) {
                return this.rankPoints[rank - 1];
            };

            Raid.calculateEfficiency = function() {
                let levelEnergy = parseInt($('#level_6 .energy').text());
                if (levelEnergy > 0) {
                    let levelPoints = parseInt($('#level_6 .points').text());
                    
                    $('#level_6 .efficiency').text(new Intl.NumberFormat('nl-BE').format(levelPoints / levelEnergy));
                }

                for (let i = 1; i < 6; i++) {
                    let rankPoints = parseInt($('#rank_' + i + ' .points').text());
                    let levelPoints = parseInt($('#level_' + i + ' .points').text());
                    let boostPoints = parseInt($('#boost_' + i + ' .points').text());
                    let levelEnergy = parseInt($('#level_' + i + ' .energy').text());
                    let boostEnergy = parseInt($('#boost_' + i + ' .energy').text());

                    if (levelEnergy > 0 || boostEnergy > 0) {
                        $('#boost_' + i + ' .efficiency').text(new Intl.NumberFormat('nl-BE').format((rankPoints + levelPoints + boostPoints) / (levelEnergy + boostEnergy)));
                    }
                }
            };

            $(document).ready(function() {
                Raid.setupUI();
            });
        })(jQuery);
    </script>
</body>
</html>